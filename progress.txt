## 2026-01-24: P3-BE-006 - SalesOrder Event Processing (Stock Locking)

### Completed Feature
Implemented sales order event handlers for inventory integration via domain events.

### Files Created
- `backend/internal/application/trade/sales_order_confirmed_handler.go`
  - Handles SalesOrderConfirmedEvent to lock stock when order is confirmed
  - Iterates through order items and locks stock for each product in the warehouse
  - Uses 30-minute default lock expiration

- `backend/internal/application/trade/sales_order_shipped_handler.go`
  - Handles SalesOrderShippedEvent to deduct locked stock when order is shipped
  - Retrieves locks by source and maps productID to lockID for deduction
  - Continues processing other items even if some fail

- `backend/internal/application/trade/sales_order_cancelled_handler.go`
  - Handles SalesOrderCancelledEvent to release stock locks when order is cancelled
  - Only releases locks if order WasConfirmed (draft orders have no locks)
  - Uses UnlockBySource for bulk unlock

- `backend/internal/application/trade/sales_order_event_handlers_test.go`
  - Comprehensive unit tests for all three handlers (18+ test cases)
  - Tests for EventTypes, Success, MissingWarehouse, WrongEventType, PartialFailure

### Files Modified
- `backend/internal/application/trade/sales_order_service.go`
  - Added eventPublisher field and SetEventPublisher method
  - Confirm method now publishes SalesOrderConfirmedEvent
  - Ship method now publishes SalesOrderShippedEvent
  - Cancel method now publishes SalesOrderCancelledEvent

- `backend/internal/application/inventory/inventory_service.go`
  - Added GetLocksBySource method with ProductID/WarehouseID enrichment
  - Added UnlockBySource method for bulk unlock by source

- `backend/internal/application/inventory/dto.go`
  - Added WarehouseID and ProductID fields to StockLockResponse

- `backend/cmd/server/main.go`
  - Registered SalesOrderConfirmedHandler
  - Registered SalesOrderShippedHandler
  - Registered SalesOrderCancelledHandler
  - Injected event publisher into SalesOrderService

### Event Flow
1. Order Confirmed -> SalesOrderConfirmedEvent -> Lock stock for each item
2. Order Shipped -> SalesOrderShippedEvent -> Deduct locked stock
3. Order Cancelled (if was confirmed) -> SalesOrderCancelledEvent -> Release stock locks

### Tests
All tests pass (`go test ./...`)
