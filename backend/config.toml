# =============================================================================
# ERP Backend Configuration
# =============================================================================
# This is the default configuration. Environment-specific overrides:
#   - config.dev.toml (development)
#   - config.test.toml (testing)
#   - config.prod.toml (production)
#
# Environment variables can override any setting using the prefix "ERP_"
# Example: ERP_DATABASE_PASSWORD=xxx overrides [database] password
# =============================================================================

[app]
name = "erp-backend"
port = "8080"

[database]
host = "localhost"
port = 5432
user = "postgres"
password = "admin123"
dbname = "erp_dev"
sslmode = "disable"
max_open_conns = 25
max_idle_conns = 5
conn_max_lifetime = 60  # minutes
conn_max_idle_time = 30 # minutes

[redis]
host = "localhost"
port = 6379
password = ""
db = 0

[jwt]
secret = ""
access_token_expiration = "15m"
refresh_token_expiration = "168h"
issuer = "erp-backend"
refresh_secret = ""
max_refresh_count = 10

[cookie]
# Domain for cookies (empty = current domain)
domain = ""
# Path for cookies
path = "/"
# Secure flag (should be true in production for HTTPS)
secure = false
# SameSite policy: "strict", "lax", or "none"
same_site = "lax"

[log]
level = "info"
format = "console"
output = "stdout"

[event]
processor_enabled = true
batch_size = 100
poll_interval = "5s"
max_retries = 5
cleanup_enabled = true
cleanup_retention = "168h"

[http]
read_timeout = "15s"
write_timeout = "15s"
idle_timeout = "60s"
max_header_bytes = 1048576    # 1MB
max_body_size = 10485760      # 10MB
rate_limit_enabled = true
rate_limit_requests = 100
rate_limit_window = "1m"
# Auth rate limiting - stricter limits for authentication endpoints (SEC-008)
auth_rate_limit_enabled = true
auth_rate_limit_requests = 5    # 5 attempts per window
auth_rate_limit_window = "1m"   # 1 minute window
# For cookie-based auth with credentials, use specific origins (not "*")
# In production, set to your actual frontend origin
cors_allow_origins = ["http://localhost:3000", "http://127.0.0.1:3000"]
cors_allow_methods = ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
cors_allow_headers = ["Content-Type", "Authorization", "X-Request-ID", "X-Tenant-ID"]
# SECURITY: If behind a reverse proxy/load balancer, set trusted_proxies to
# prevent IP spoofing attacks on the rate limiter. Empty = trust only RemoteAddr.
# Example for internal network: trusted_proxies = ["10.0.0.0/8", "172.16.0.0/12"]
trusted_proxies = []

[scheduler]
enabled = true
daily_cron_schedule = "0 2 * * *"  # 2am daily
max_concurrent_jobs = 3
job_timeout = "30m"
retry_attempts = 3
retry_delay = "5m"

[stock_lock]
# Stock lock expiration check interval
check_interval = "5m"
# Default lock expiration duration (24 hours as per spec)
default_expiration = "24h"
# Enable automatic expiration cleanup
auto_release_enabled = true

[swagger]
# Enable Swagger documentation endpoint (default: true in dev, false in production)
enabled = true
# Require authentication to access Swagger (only applies when enabled=true in production)
require_auth = false
# Allowed IP addresses (empty = allow all). Use this for IP-based restriction in production.
# Example: ["127.0.0.1", "10.0.0.0/8", "192.168.0.0/16"]
allowed_ips = []

[telemetry]
# Enable OpenTelemetry tracing
enabled = true
# OTEL Collector gRPC endpoint
collector_endpoint = "localhost:4317"
# Sampling ratio (0.0-1.0, 1.0 = 100% of traces)
# Development: 1.0 (all traces), Production: consider 0.1-0.5 depending on traffic
sampling_ratio = 1.0
# Service name for traces (used in Jaeger, Zipkin, etc.)
service_name = "erp-backend"
# Use insecure (non-TLS) connection to collector
# Set to true for local development, false for production (TLS required)
insecure = true
