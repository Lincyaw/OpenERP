# 进销存系统开发规划

**项目名称:** ERP 进销存系统
**版本:** v1.0
**创建日期:** 2026-01-23
**状态:** 规划中

---

## 目录

1. [团队角色分工](#1-团队角色分工)
2. [项目阶段划分](#2-项目阶段划分)
3. [详细任务分解](#3-详细任务分解)
4. [依赖关系图](#4-依赖关系图)
5. [里程碑与交付物](#5-里程碑与交付物)
6. [联调验证方案](#6-联调验证方案)
7. [测试策略](#7-测试策略)
8. [冒烟测试用例](#8-冒烟测试用例)
9. [风险管理](#9-风险管理)
10. [进度跟踪](#10-进度跟踪)

---

## 1. 团队角色分工

### 1.1 产品组 (Product Team)

| 成员代号 | 职责 |
|----------|------|
| **PD-1** | 需求细化、原型设计、验收标准制定 |
| **PD-2** | 用户故事编写、业务流程图、UAT 测试 |

### 1.2 后端开发组 (Backend Team)

| 成员代号 | 专注领域 |
|----------|----------|
| **BE-1** | 商品上下文、伙伴上下文、基础架构 |
| **BE-2** | 库存上下文、策略模式实现 |
| **BE-3** | 交易上下文（销售/采购订单、退货） |
| **BE-4** | 财务上下文、报表上下文 |
| **BE-5** | 身份认证、多租户、外部集成 |

### 1.3 前端开发组 (Frontend Team)

| 成员代号 | 专注领域 |
|----------|----------|
| **FE-1** | 基础框架、认证模块、布局组件 |
| **FE-2** | 商品管理、伙伴管理页面 |
| **FE-3** | 库存管理、盘点页面 |
| **FE-4** | 交易模块（销售/采购/退货） |
| **FE-5** | 财务模块、报表模块 |

### 1.4 测试组 (QA Team)

| 成员代号 | 职责 |
|----------|------|
| **QA-1** | 单元测试规范、后端 API 测试 |
| **QA-2** | 前端组件测试、E2E 测试 |
| **QA-3** | 性能测试、安全测试 |

---

## 2. 项目阶段划分

```
Phase 0: 基础设施搭建
    ↓
Phase 1: 支撑域开发 (商品 + 伙伴)
    ↓
Phase 2: 核心域开发 - 库存
    ↓
Phase 3: 核心域开发 - 交易
    ↓
Phase 4: 核心域开发 - 财务
    ↓
Phase 5: 通用域开发 - 报表
    ↓
Phase 6: 横切关注点 (多租户 + 权限)
    ↓
Phase 7: 外部集成
    ↓
Phase 8: 系统集成测试 & UAT
```

---

## 3. 详细任务分解

### Phase 0: 基础设施搭建

#### P0-BE: 后端基础设施

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P0-BE-001 | 项目脚手架搭建 (Go Module, 目录结构) | BE-1 | 无 | P0-BE-002, P0-BE-003 | 1d |
| P0-BE-002 | 数据库连接配置 (PostgreSQL) | BE-1 | P0-BE-001 | P0-BE-004 | 0.5d |
| P0-BE-003 | 日志框架配置 | BE-1 | P0-BE-001 | 全部后端任务 | 0.5d |
| P0-BE-004 | 数据库迁移工具配置 (golang-migrate) | BE-1 | P0-BE-002 | P1-BE-001 | 0.5d |
| P0-BE-005 | 通用值对象实现 (Money, Quantity) | BE-2 | P0-BE-001 | P1-BE-*, P2-BE-* | 1d |
| P0-BE-006 | 领域事件基础设施 (EventBus, Outbox) | BE-2 | P0-BE-002 | P2-BE-005, P3-BE-* | 2d |
| P0-BE-007 | 策略注册中心实现 | BE-2 | P0-BE-001 | P2-BE-003 | 1d |
| P0-BE-008 | HTTP 框架配置 (Gin/Echo) | BE-1 | P0-BE-001 | P1-BE-003 | 0.5d |
| P0-BE-009 | API 响应格式统一 | BE-1 | P0-BE-008 | 全部 API 任务 | 0.5d |
| P0-BE-010 | 单元测试框架配置 | QA-1 | P0-BE-001 | 全部测试任务 | 0.5d |

#### P0-FE: 前端基础设施

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P0-FE-001 | 项目脚手架搭建 (React/Vue + TypeScript) | FE-1 | 无 | P0-FE-002, P0-FE-003 | 1d |
| P0-FE-002 | UI 组件库集成 (Ant Design/Element) | FE-1 | P0-FE-001 | 全部前端页面 | 0.5d |
| P0-FE-003 | 路由配置 | FE-1 | P0-FE-001 | P1-FE-001 | 0.5d |
| P0-FE-004 | 状态管理配置 (Redux/Pinia) | FE-1 | P0-FE-001 | P1-FE-002 | 0.5d |
| P0-FE-005 | HTTP 客户端封装 (Axios) | FE-1 | P0-FE-001 | 全部 API 调用 | 0.5d |
| P0-FE-006 | 布局组件 (Header, Sidebar, Content) | FE-1 | P0-FE-002 | 全部页面 | 1d |
| P0-FE-007 | 通用表单组件 | FE-2 | P0-FE-002 | 全部表单页面 | 1d |
| P0-FE-008 | 通用表格组件 | FE-2 | P0-FE-002 | 全部列表页面 | 1d |
| P0-FE-009 | 前端测试框架配置 (Jest/Vitest) | QA-2 | P0-FE-001 | 全部前端测试 | 0.5d |

#### P0-PD: 产品工作

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P0-PD-001 | 商品模块原型设计 | PD-1 | 无 | P1-FE-001 | 2d |
| P0-PD-002 | 伙伴模块原型设计 | PD-1 | 无 | P1-FE-004 | 2d |
| P0-PD-003 | 库存模块原型设计 | PD-1 | 无 | P2-FE-001 | 2d |
| P0-PD-004 | 交易模块原型设计 | PD-2 | 无 | P3-FE-001 | 3d |
| P0-PD-005 | 财务模块原型设计 | PD-2 | 无 | P4-FE-001 | 2d |

---

### Phase 1: 支撑域 - 商品上下文 + 伙伴上下文

#### P1-BE: 后端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| **商品上下文** |||||
| P1-BE-001 | Category 聚合实现 | BE-1 | P0-BE-004 | P1-BE-002 | 1d |
| P1-BE-002 | Product 聚合根实现 | BE-1 | P1-BE-001, P0-BE-005 | P1-BE-003 | 2d |
| P1-BE-003 | Product Repository 接口 + 实现 | BE-1 | P1-BE-002 | P1-BE-004 | 1d |
| P1-BE-004 | Product Application Service | BE-1 | P1-BE-003 | P1-BE-005 | 1d |
| P1-BE-005 | Product API (CRUD + enable/disable) | BE-1 | P1-BE-004, P0-BE-008 | P1-联调-001 | 1d |
| P1-BE-006 | ProductUnit 多单位支持 | BE-1 | P1-BE-002 | P3-BE-003 | 1d |
| P1-BE-007 | Product 领域事件发布 | BE-1 | P1-BE-002, P0-BE-006 | P2-BE-005 | 0.5d |
| **伙伴上下文** |||||
| P1-BE-010 | Customer 聚合根实现 | BE-1 | P0-BE-005 | P1-BE-012 | 1.5d |
| P1-BE-011 | Supplier 聚合根实现 | BE-1 | P0-BE-005 | P1-BE-012 | 1d |
| P1-BE-012 | Warehouse 聚合根实现 | BE-1 | P0-BE-005 | P1-BE-013 | 1d |
| P1-BE-013 | Partner Repository 接口 + 实现 | BE-1 | P1-BE-010, P1-BE-011, P1-BE-012 | P1-BE-014 | 1.5d |
| P1-BE-014 | Partner Application Service | BE-1 | P1-BE-013 | P1-BE-015 | 1d |
| P1-BE-015 | Partner API (Customer/Supplier/Warehouse) | BE-1 | P1-BE-014, P0-BE-008 | P1-联调-002 | 1.5d |
| P1-BE-016 | CustomerBalance 余额功能 | BE-1 | P1-BE-010 | P4-BE-006 | 1d |
| P1-BE-017 | BalanceTransaction 实现 | BE-1 | P1-BE-016 | P1-BE-018 | 1d |
| P1-BE-018 | Customer Balance API | BE-1 | P1-BE-017 | P1-联调-003 | 0.5d |

#### P1-FE: 前端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| **商品模块** |||||
| P1-FE-001 | 商品列表页面 | FE-2 | P0-FE-006, P0-FE-008, P0-PD-001 | P1-联调-001 | 1.5d |
| P1-FE-002 | 商品新增/编辑表单 | FE-2 | P0-FE-007, P0-PD-001 | P1-联调-001 | 1.5d |
| P1-FE-003 | 商品分类管理 (树形结构) | FE-2 | P0-FE-002 | P1-联调-001 | 1d |
| **伙伴模块** |||||
| P1-FE-004 | 客户列表页面 | FE-2 | P0-FE-006, P0-FE-008, P0-PD-002 | P1-联调-002 | 1d |
| P1-FE-005 | 客户新增/编辑表单 | FE-2 | P0-FE-007 | P1-联调-002 | 1d |
| P1-FE-006 | 供应商列表页面 | FE-2 | P0-FE-006, P0-FE-008 | P1-联调-002 | 1d |
| P1-FE-007 | 供应商新增/编辑表单 | FE-2 | P0-FE-007 | P1-联调-002 | 1d |
| P1-FE-008 | 仓库管理页面 | FE-2 | P0-FE-006 | P1-联调-002 | 1d |
| P1-FE-009 | 客户余额管理页面 | FE-2 | P1-FE-004 | P1-联调-003 | 1d |
| P1-FE-010 | 客户充值弹窗 | FE-2 | P1-FE-009 | P1-联调-003 | 0.5d |

#### P1-QA: 测试任务

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P1-QA-001 | Product 聚合单元测试 | QA-1 | P1-BE-002 | P1-联调-001 | 1d |
| P1-QA-002 | Product API 集成测试 | QA-1 | P1-BE-005 | P1-联调-001 | 1d |
| P1-QA-003 | Partner 聚合单元测试 | QA-1 | P1-BE-013 | P1-联调-002 | 1d |
| P1-QA-004 | Partner API 集成测试 | QA-1 | P1-BE-015 | P1-联调-002 | 1d |
| P1-QA-005 | 商品模块前端组件测试 | QA-2 | P1-FE-002 | P1-联调-001 | 1d |
| P1-QA-006 | 伙伴模块前端组件测试 | QA-2 | P1-FE-005 | P1-联调-002 | 1d |

#### P1-联调: 联调验证

| 任务ID | 任务名称 | 参与人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P1-联调-001 | 商品模块前后端联调 | BE-1, FE-2, QA-1 | P1-BE-005, P1-FE-002, P1-QA-002 | P2-BE-001 | 1d |
| P1-联调-002 | 伙伴模块前后端联调 | BE-1, FE-2, QA-1 | P1-BE-015, P1-FE-008, P1-QA-004 | P3-BE-001 | 1d |
| P1-联调-003 | 客户余额功能联调 | BE-1, FE-2 | P1-BE-018, P1-FE-010 | P4-BE-006 | 0.5d |

---

### Phase 2: 核心域 - 库存上下文

#### P2-BE: 后端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P2-BE-001 | InventoryItem 聚合根实现 | BE-2 | P1-联调-001 | P2-BE-002 | 2d |
| P2-BE-002 | StockBatch 实体实现 | BE-2 | P2-BE-001 | P2-BE-003 | 1d |
| P2-BE-003 | 成本计算策略实现 (移动加权/FIFO) | BE-2 | P0-BE-007, P2-BE-002 | P2-BE-004 | 1.5d |
| P2-BE-004 | 批次管理策略实现 | BE-2 | P2-BE-002, P0-BE-007 | P2-BE-006 | 1d |
| P2-BE-005 | InventoryTransaction 实现 | BE-2 | P2-BE-001 | P2-BE-006 | 1d |
| P2-BE-006 | StockLock 实现 (乐观锁) | BE-2 | P2-BE-001 | P2-BE-007 | 1.5d |
| P2-BE-007 | Inventory Repository 接口 + 实现 | BE-2 | P2-BE-006 | P2-BE-008 | 1.5d |
| P2-BE-008 | Inventory Application Service | BE-2 | P2-BE-007 | P2-BE-009 | 1.5d |
| P2-BE-009 | Inventory API (查询/锁定/调整) | BE-2 | P2-BE-008 | P2-联调-001 | 1d |
| P2-BE-010 | 库存领域事件实现 | BE-2 | P2-BE-001, P0-BE-006 | P3-BE-006, P4-BE-005 | 1d |
| P2-BE-011 | StockTaking 盘点聚合实现 | BE-2 | P2-BE-001 | P2-BE-012 | 1.5d |
| P2-BE-012 | StockTaking API | BE-2 | P2-BE-011 | P2-联调-002 | 1d |

#### P2-FE: 前端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P2-FE-001 | 库存查询列表页面 | FE-3 | P0-FE-006, P0-PD-003 | P2-联调-001 | 1.5d |
| P2-FE-002 | 库存明细页面 (批次/流水) | FE-3 | P2-FE-001 | P2-联调-001 | 1d |
| P2-FE-003 | 库存调整页面 | FE-3 | P2-FE-001 | P2-联调-001 | 1d |
| P2-FE-004 | 盘点单创建页面 | FE-3 | P0-FE-007 | P2-联调-002 | 1.5d |
| P2-FE-005 | 盘点执行页面 | FE-3 | P2-FE-004 | P2-联调-002 | 1d |
| P2-FE-006 | 库存预警配置页面 | FE-3 | P2-FE-001 | P2-联调-001 | 0.5d |

#### P2-QA: 测试任务

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P2-QA-001 | InventoryItem 聚合单元测试 | QA-1 | P2-BE-001 | P2-QA-002 | 1.5d |
| P2-QA-002 | 成本计算策略单元测试 | QA-1 | P2-BE-003 | P2-联调-001 | 1d |
| P2-QA-003 | 库存锁定并发测试 | QA-3 | P2-BE-006 | P2-联调-001 | 1d |
| P2-QA-004 | Inventory API 集成测试 | QA-1 | P2-BE-009 | P2-联调-001 | 1d |
| P2-QA-005 | 库存模块前端组件测试 | QA-2 | P2-FE-003 | P2-联调-001 | 1d |

#### P2-联调: 联调验证

| 任务ID | 任务名称 | 参与人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P2-联调-001 | 库存模块前后端联调 | BE-2, FE-3, QA-1 | P2-BE-009, P2-FE-003, P2-QA-004 | P3-BE-001 | 1d |
| P2-联调-002 | 盘点功能联调 | BE-2, FE-3 | P2-BE-012, P2-FE-005 | - | 0.5d |

---

### Phase 3: 核心域 - 交易上下文

#### P3-BE: 后端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| **销售订单** |||||
| P3-BE-001 | SalesOrder 聚合根实现 | BE-3 | P1-联调-002, P2-联调-001 | P3-BE-002 | 2d |
| P3-BE-002 | SalesOrderItem 实体实现 | BE-3 | P3-BE-001 | P3-BE-003 | 1d |
| P3-BE-003 | 多单位数量换算 | BE-3 | P3-BE-002, P1-BE-006 | P3-BE-004 | 1d |
| P3-BE-004 | 定价策略实现 (标准/阶梯) | BE-3 | P3-BE-001, P0-BE-007 | P3-BE-005 | 1d |
| P3-BE-005 | SalesOrder Application Service | BE-3 | P3-BE-004 | P3-BE-006 | 1.5d |
| P3-BE-006 | SalesOrder 事件处理 (库存锁定) | BE-3 | P3-BE-005, P2-BE-010 | P3-BE-007 | 1d |
| P3-BE-007 | SalesOrder API | BE-3 | P3-BE-006 | P3-联调-001 | 1d |
| **采购订单** |||||
| P3-BE-010 | PurchaseOrder 聚合根实现 | BE-3 | P1-联调-002 | P3-BE-011 | 2d |
| P3-BE-011 | 采购收货逻辑 (分批入库) | BE-3 | P3-BE-010, P2-BE-001 | P3-BE-012 | 1.5d |
| P3-BE-012 | PurchaseOrder Application Service | BE-3 | P3-BE-011 | P3-BE-013 | 1.5d |
| P3-BE-013 | PurchaseOrder API | BE-3 | P3-BE-012 | P3-联调-002 | 1d |
| **销售退货** |||||
| P3-BE-020 | SalesReturn 聚合根实现 | BE-3 | P3-BE-001 | P3-BE-021 | 1.5d |
| P3-BE-021 | SalesReturn 审批流程 | BE-3 | P3-BE-020 | P3-BE-022 | 1d |
| P3-BE-022 | SalesReturn 事件处理 (库存恢复) | BE-3 | P3-BE-021, P2-BE-010 | P3-BE-023 | 1d |
| P3-BE-023 | SalesReturn API | BE-3 | P3-BE-022 | P3-联调-003 | 1d |
| **采购退货** |||||
| P3-BE-030 | PurchaseReturn 聚合根实现 | BE-3 | P3-BE-010 | P3-BE-031 | 1.5d |
| P3-BE-031 | PurchaseReturn 发货流程 | BE-3 | P3-BE-030, P2-BE-001 | P3-BE-032 | 1d |
| P3-BE-032 | PurchaseReturn API | BE-3 | P3-BE-031 | P3-联调-004 | 1d |

#### P3-FE: 前端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| **销售模块** |||||
| P3-FE-001 | 销售订单列表页面 | FE-4 | P0-FE-006, P0-PD-004 | P3-联调-001 | 1.5d |
| P3-FE-002 | 销售开单页面 | FE-4 | P0-FE-007, P1-FE-001 | P3-联调-001 | 2d |
| P3-FE-003 | 销售订单详情页面 | FE-4 | P3-FE-001 | P3-联调-001 | 1d |
| P3-FE-004 | 销售订单发货操作 | FE-4 | P3-FE-003 | P3-联调-001 | 0.5d |
| **采购模块** |||||
| P3-FE-010 | 采购订单列表页面 | FE-4 | P0-FE-006 | P3-联调-002 | 1.5d |
| P3-FE-011 | 采购开单页面 | FE-4 | P0-FE-007 | P3-联调-002 | 2d |
| P3-FE-012 | 采购收货页面 | FE-4 | P3-FE-010 | P3-联调-002 | 1.5d |
| **退货模块** |||||
| P3-FE-020 | 销售退货列表页面 | FE-4 | P3-FE-001 | P3-联调-003 | 1d |
| P3-FE-021 | 销售退货创建页面 | FE-4 | P3-FE-020 | P3-联调-003 | 1.5d |
| P3-FE-022 | 销售退货审批页面 | FE-4 | P3-FE-020 | P3-联调-003 | 1d |
| P3-FE-030 | 采购退货列表页面 | FE-4 | P3-FE-010 | P3-联调-004 | 1d |
| P3-FE-031 | 采购退货创建页面 | FE-4 | P3-FE-030 | P3-联调-004 | 1.5d |

#### P3-QA: 测试任务

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P3-QA-001 | SalesOrder 聚合单元测试 | QA-1 | P3-BE-001 | P3-QA-003 | 1.5d |
| P3-QA-002 | PurchaseOrder 聚合单元测试 | QA-1 | P3-BE-010 | P3-QA-003 | 1.5d |
| P3-QA-003 | 订单状态流转测试 | QA-1 | P3-QA-001, P3-QA-002 | P3-联调-001 | 1d |
| P3-QA-004 | 订单-库存联动集成测试 | QA-1 | P3-BE-006 | P3-联调-001 | 1.5d |
| P3-QA-005 | 交易模块前端组件测试 | QA-2 | P3-FE-002 | P3-联调-001 | 1d |
| P3-QA-006 | 退货流程端到端测试 | QA-2 | P3-BE-023, P3-FE-022 | P3-联调-003 | 1d |

#### P3-联调: 联调验证

| 任务ID | 任务名称 | 参与人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P3-联调-001 | 销售订单前后端联调 | BE-3, FE-4, QA-1 | P3-BE-007, P3-FE-004, P3-QA-004 | P4-BE-001 | 1.5d |
| P3-联调-002 | 采购订单前后端联调 | BE-3, FE-4, QA-1 | P3-BE-013, P3-FE-012 | P4-BE-002 | 1d |
| P3-联调-003 | 销售退货全流程联调 | BE-3, FE-4, QA-2 | P3-BE-023, P3-FE-022, P3-QA-006 | P4-BE-004 | 1d |
| P3-联调-004 | 采购退货全流程联调 | BE-3, FE-4 | P3-BE-032, P3-FE-031 | P4-BE-004 | 1d |

---

### Phase 4: 核心域 - 财务上下文

#### P4-BE: 后端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| **应收应付** |||||
| P4-BE-001 | AccountReceivable 聚合实现 | BE-4 | P3-联调-001 | P4-BE-003 | 1.5d |
| P4-BE-002 | AccountPayable 聚合实现 | BE-4 | P3-联调-002 | P4-BE-003 | 1.5d |
| P4-BE-003 | 应收应付自动生成 (事件处理) | BE-4 | P4-BE-001, P4-BE-002, P0-BE-006 | P4-BE-005 | 1.5d |
| P4-BE-004 | 红冲逻辑实现 (退货关联) | BE-4 | P4-BE-001, P3-联调-003 | P4-BE-008 | 1d |
| **收付款** |||||
| P4-BE-005 | ReceiptVoucher 收款单实现 | BE-4 | P4-BE-003 | P4-BE-007 | 1.5d |
| P4-BE-006 | 余额支付逻辑 | BE-4 | P4-BE-005, P1-联调-003 | P4-BE-007 | 1d |
| P4-BE-007 | PaymentVoucher 付款单实现 | BE-4 | P4-BE-003 | P4-BE-008 | 1.5d |
| P4-BE-008 | 核销策略实现 (FIFO) | BE-4 | P4-BE-005, P4-BE-007, P0-BE-007 | P4-BE-009 | 1.5d |
| P4-BE-009 | ReconciliationService 核销服务 | BE-4 | P4-BE-008 | P4-BE-010 | 1d |
| P4-BE-010 | Finance API (应收/应付/收款/付款) | BE-4 | P4-BE-009 | P4-联调-001 | 1.5d |
| **日常收支** |||||
| P4-BE-015 | ExpenseRecord 费用聚合实现 | BE-4 | P0-BE-005 | P4-BE-017 | 1d |
| P4-BE-016 | OtherIncomeRecord 其他收入实现 | BE-4 | P0-BE-005 | P4-BE-017 | 1d |
| P4-BE-017 | Expense/Income API | BE-4 | P4-BE-015, P4-BE-016 | P4-联调-002 | 1d |

#### P4-FE: 前端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| **应收应付** |||||
| P4-FE-001 | 应收账款列表页面 | FE-5 | P0-FE-006, P0-PD-005 | P4-联调-001 | 1.5d |
| P4-FE-002 | 应付账款列表页面 | FE-5 | P0-FE-006 | P4-联调-001 | 1.5d |
| **收付款** |||||
| P4-FE-003 | 收款单创建页面 | FE-5 | P4-FE-001 | P4-联调-001 | 1.5d |
| P4-FE-004 | 收款核销页面 | FE-5 | P4-FE-003 | P4-联调-001 | 1d |
| P4-FE-005 | 付款单创建页面 | FE-5 | P4-FE-002 | P4-联调-001 | 1.5d |
| P4-FE-006 | 付款核销页面 | FE-5 | P4-FE-005 | P4-联调-001 | 1d |
| **日常收支** |||||
| P4-FE-010 | 费用录入页面 | FE-5 | P0-FE-007 | P4-联调-002 | 1d |
| P4-FE-011 | 其他收入录入页面 | FE-5 | P0-FE-007 | P4-联调-002 | 1d |
| P4-FE-012 | 收支流水页面 | FE-5 | P4-FE-010 | P4-联调-002 | 1d |

#### P4-QA: 测试任务

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P4-QA-001 | 应收应付聚合单元测试 | QA-1 | P4-BE-002 | P4-QA-003 | 1d |
| P4-QA-002 | 核销策略单元测试 | QA-1 | P4-BE-008 | P4-QA-003 | 1d |
| P4-QA-003 | 交易-财务联动集成测试 | QA-1 | P4-BE-003 | P4-联调-001 | 1.5d |
| P4-QA-004 | 财务数据准确性测试 | QA-1 | P4-BE-009 | P4-联调-001 | 1d |
| P4-QA-005 | 财务模块前端组件测试 | QA-2 | P4-FE-004 | P4-联调-001 | 1d |

#### P4-联调: 联调验证

| 任务ID | 任务名称 | 参与人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P4-联调-001 | 财务核心功能联调 | BE-4, FE-5, QA-1 | P4-BE-010, P4-FE-006, P4-QA-004 | P5-BE-001 | 1.5d |
| P4-联调-002 | 日常收支功能联调 | BE-4, FE-5 | P4-BE-017, P4-FE-012 | P5-BE-003 | 0.5d |

---

### Phase 5: 通用域 - 报表上下文

#### P5-BE: 后端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P5-BE-001 | SalesReport 读模型实现 | BE-4 | P4-联调-001 | P5-BE-004 | 1.5d |
| P5-BE-002 | InventoryTurnover 读模型实现 | BE-4 | P2-联调-001 | P5-BE-004 | 1d |
| P5-BE-003 | ProfitLossStatement 损益表实现 | BE-4 | P4-联调-002 | P5-BE-004 | 1.5d |
| P5-BE-004 | CashFlowStatement 现金流量表 | BE-4 | P5-BE-001, P5-BE-003 | P5-BE-005 | 1.5d |
| P5-BE-005 | Report API (查询接口) | BE-4 | P5-BE-004 | P5-联调-001 | 1d |
| P5-BE-006 | 报表数据异步聚合 (定时任务) | BE-4 | P5-BE-005, P0-BE-006 | P5-联调-001 | 1.5d |

#### P5-FE: 前端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P5-FE-001 | 销售报表页面 (图表) | FE-5 | P0-FE-006 | P5-联调-001 | 1.5d |
| P5-FE-002 | 销售排行榜页面 | FE-5 | P5-FE-001 | P5-联调-001 | 1d |
| P5-FE-003 | 库存周转报表页面 | FE-5 | P0-FE-006 | P5-联调-001 | 1d |
| P5-FE-004 | 损益报表页面 | FE-5 | P0-FE-006 | P5-联调-001 | 1.5d |
| P5-FE-005 | 现金流量报表页面 | FE-5 | P0-FE-006 | P5-联调-001 | 1.5d |
| P5-FE-006 | Dashboard 首页看板 | FE-5 | P5-FE-001, P5-FE-003 | P5-联调-001 | 2d |

#### P5-联调: 联调验证

| 任务ID | 任务名称 | 参与人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P5-联调-001 | 报表模块联调 | BE-4, FE-5 | P5-BE-005, P5-FE-006 | - | 1d |

---

### Phase 6: 横切关注点 - 多租户 + 权限

#### P6-BE: 后端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| **多租户** |||||
| P6-BE-001 | Tenant 聚合实现 | BE-5 | P0-BE-001 | P6-BE-002 | 1.5d |
| P6-BE-002 | 租户中间件 (tenant_id 注入) | BE-5 | P6-BE-001 | P6-BE-003 | 1d |
| P6-BE-003 | Repository 层自动 tenant_id 过滤 | BE-5 | P6-BE-002 | P6-BE-010 | 2d |
| P6-BE-004 | Tenant API | BE-5 | P6-BE-001 | P6-联调-001 | 1d |
| **身份认证** |||||
| P6-BE-010 | User 聚合实现 | BE-5 | P6-BE-003 | P6-BE-011 | 1.5d |
| P6-BE-011 | Role 聚合实现 | BE-5 | P6-BE-010 | P6-BE-012 | 1.5d |
| P6-BE-012 | Permission 权限模型实现 | BE-5 | P6-BE-011 | P6-BE-013 | 1d |
| P6-BE-013 | DataScope 数据权限实现 | BE-5 | P6-BE-012 | P6-BE-014 | 1.5d |
| P6-BE-014 | JWT 认证中间件 | BE-5 | P6-BE-010 | P6-BE-015 | 1d |
| P6-BE-015 | 权限校验中间件 | BE-5 | P6-BE-014 | P6-BE-016 | 1.5d |
| P6-BE-016 | Auth API (登录/登出/刷新) | BE-5 | P6-BE-015 | P6-联调-002 | 1d |
| P6-BE-017 | User/Role 管理 API | BE-5 | P6-BE-015 | P6-联调-003 | 1d |

#### P6-FE: 前端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P6-FE-001 | 登录页面 | FE-1 | P0-FE-001 | P6-联调-002 | 1d |
| P6-FE-002 | Token 存储与刷新逻辑 | FE-1 | P6-FE-001 | P6-联调-002 | 0.5d |
| P6-FE-003 | 路由权限控制 | FE-1 | P6-FE-002 | P6-联调-002 | 1d |
| P6-FE-004 | 用户管理页面 | FE-1 | P0-FE-006 | P6-联调-003 | 1.5d |
| P6-FE-005 | 角色管理页面 | FE-1 | P6-FE-004 | P6-联调-003 | 1.5d |
| P6-FE-006 | 权限配置页面 | FE-1 | P6-FE-005 | P6-联调-003 | 1d |
| P6-FE-007 | 租户切换组件 | FE-1 | P6-FE-001 | P6-联调-001 | 0.5d |

#### P6-QA: 测试任务

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P6-QA-001 | 租户隔离测试 | QA-3 | P6-BE-003 | P6-联调-001 | 1.5d |
| P6-QA-002 | 权限控制测试 | QA-3 | P6-BE-015 | P6-联调-002 | 1.5d |
| P6-QA-003 | 安全漏洞扫描 | QA-3 | P6-BE-016 | P6-联调-002 | 1d |

#### P6-联调: 联调验证

| 任务ID | 任务名称 | 参与人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P6-联调-001 | 多租户隔离联调 | BE-5, FE-1, QA-3 | P6-BE-004, P6-FE-007, P6-QA-001 | - | 1d |
| P6-联调-002 | 认证授权联调 | BE-5, FE-1, QA-3 | P6-BE-016, P6-FE-003, P6-QA-002 | - | 1d |
| P6-联调-003 | 用户角色管理联调 | BE-5, FE-1 | P6-BE-017, P6-FE-006 | - | 0.5d |

---

### Phase 7: 外部集成

#### P7-BE: 后端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| **支付集成** |||||
| P7-BE-001 | PaymentGateway Port 定义 | BE-5 | P4-联调-001 | P7-BE-002 | 0.5d |
| P7-BE-002 | 微信支付 Adapter | BE-5 | P7-BE-001 | P7-BE-004 | 2d |
| P7-BE-003 | 支付宝 Adapter | BE-5 | P7-BE-001 | P7-BE-004 | 2d |
| P7-BE-004 | 支付回调处理服务 | BE-5 | P7-BE-002, P7-BE-003 | P7-联调-001 | 1.5d |
| **电商集成** |||||
| P7-BE-010 | EcommercePlatform Port 定义 | BE-5 | P3-联调-001 | P7-BE-011 | 0.5d |
| P7-BE-011 | ProductMapping 实现 | BE-5 | P7-BE-010 | P7-BE-012 | 1d |
| P7-BE-012 | 淘宝 Adapter (可选) | BE-5 | P7-BE-011 | P7-BE-014 | 3d |
| P7-BE-013 | 抖音 Adapter (可选) | BE-5 | P7-BE-011 | P7-BE-014 | 3d |
| P7-BE-014 | 订单同步定时任务 | BE-5 | P7-BE-012 | P7-联调-002 | 1.5d |

#### P7-FE: 前端开发

| 任务ID | 任务名称 | 负责人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P7-FE-001 | 支付方式配置页面 | FE-5 | P0-FE-006 | P7-联调-001 | 1d |
| P7-FE-002 | 电商平台配置页面 | FE-5 | P0-FE-006 | P7-联调-002 | 1d |
| P7-FE-003 | 商品映射管理页面 | FE-5 | P7-FE-002 | P7-联调-002 | 1.5d |
| P7-FE-004 | 平台订单同步状态页面 | FE-5 | P7-FE-002 | P7-联调-002 | 1d |

#### P7-联调: 联调验证

| 任务ID | 任务名称 | 参与人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P7-联调-001 | 支付功能联调 | BE-5, FE-5 | P7-BE-004, P7-FE-001 | - | 1d |
| P7-联调-002 | 电商订单同步联调 | BE-5, FE-5 | P7-BE-014, P7-FE-004 | - | 1d |

---

### Phase 8: 系统集成测试 & UAT

| 任务ID | 任务名称 | 参与人 | 前置依赖 | 后置被依赖 | 预估工作量 |
|--------|----------|--------|----------|------------|------------|
| P8-001 | 端到端业务流程测试 | QA-2 | 所有 Phase 7 | P8-002 | 3d |
| P8-002 | 性能压力测试 | QA-3 | P8-001 | P8-003 | 2d |
| P8-003 | 安全渗透测试 | QA-3 | P8-002 | P8-004 | 2d |
| P8-004 | UAT 用户验收测试 | PD-1, PD-2 | P8-003 | P8-005 | 3d |
| P8-005 | 问题修复与回归 | 全体 | P8-004 | - | 3d |

---

## 4. 依赖关系图

### 4.1 高层依赖关系

```
┌──────────────────────────────────────────────────────────────────────────┐
│                           Phase 0: 基础设施                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ BE 脚手架    │  │ FE 脚手架    │  │ 值对象      │  │ 事件基础设施  │     │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘     │
└─────────┼────────────────┼────────────────┼────────────────┼────────────┘
          │                │                │                │
          ▼                ▼                ▼                ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                      Phase 1: 商品 + 伙伴 (支撑域)                         │
│  ┌─────────────────────────┐      ┌─────────────────────────┐            │
│  │     商品上下文           │      │      伙伴上下文          │            │
│  │  Product → Category     │      │  Customer, Supplier      │            │
│  │  ProductUnit (多单位)   │      │  Warehouse, Balance      │            │
│  └────────────┬────────────┘      └────────────┬────────────┘            │
└───────────────┼─────────────────────────────────┼────────────────────────┘
                │                                 │
                ▼                                 ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                        Phase 2: 库存 (核心域)                              │
│  ┌───────────────────────────────────────────────────────────────────┐   │
│  │                    InventoryItem                                   │   │
│  │     StockBatch │ StockLock │ InventoryTransaction                 │   │
│  │     成本策略 │ 批次策略 │ 盘点                                      │   │
│  └───────────────────────────────────────────────────────────────────┘   │
└───────────────────────────────────────┬──────────────────────────────────┘
                                        │
                                        ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                        Phase 3: 交易 (核心域)                              │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────┐   │
│  │   SalesOrder    │  │  PurchaseOrder  │  │   SalesReturn           │   │
│  │   订单项 → 锁库存│  │  收货 → 入库    │  │   PurchaseReturn        │   │
│  └────────┬────────┘  └────────┬────────┘  └────────────┬────────────┘   │
└───────────┼────────────────────┼────────────────────────┼────────────────┘
            │                    │                        │
            ▼                    ▼                        ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                        Phase 4: 财务 (核心域)                              │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────┐   │
│  │ AccountReceivable│  │ AccountPayable  │  │   ExpenseRecord        │   │
│  │ ReceiptVoucher  │  │ PaymentVoucher  │  │   OtherIncomeRecord    │   │
│  │ 核销策略        │  │ 红冲            │  │                         │   │
│  └────────┬────────┘  └────────┬────────┘  └────────────┬────────────┘   │
└───────────┼────────────────────┼────────────────────────┼────────────────┘
            │                    │                        │
            ▼                    ▼                        ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                        Phase 5: 报表 (通用域)                              │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │   SalesReport │ InventoryTurnover │ ProfitLoss │ CashFlow           │ │
│  │   Dashboard 首页看板                                                 │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────┐
│          Phase 6: 多租户 + 权限 (横切关注点，与 P1-P5 并行开发)             │
│  ┌─────────────────────────┐      ┌─────────────────────────┐            │
│  │     多租户               │      │      身份权限            │            │
│  │  Tenant, tenant_id      │      │  User, Role, Permission  │            │
│  │  数据隔离中间件          │      │  JWT, DataScope          │            │
│  └─────────────────────────┘      └─────────────────────────┘            │
└──────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────┐
│                      Phase 7: 外部集成 (可选)                              │
│  ┌─────────────────────────┐      ┌─────────────────────────┐            │
│  │     支付网关             │      │     电商平台             │            │
│  │  微信/支付宝 Adapter     │      │  淘宝/抖音 Adapter       │            │
│  └─────────────────────────┘      └─────────────────────────┘            │
└──────────────────────────────────────────────────────────────────────────┘
```

### 4.2 事件驱动依赖

```
领域事件流:

SalesOrderConfirmed ──────────────────►  库存锁定 (StockLocked)
        │
        ▼
SalesOrderShipped ────────────────────►  库存扣减 (StockDeducted)
        │                                     │
        ▼                                     ▼
财务: AccountReceivable 创建           InventoryCostChanged
                                              │
                                              ▼
                                       财务: 存货价值更新

PurchaseOrderReceived ────────────────►  库存入库 (StockIncreased)
        │                                     │
        ▼                                     ▼
财务: AccountPayable 创建              InventoryCostChanged

SalesReturnCompleted ─────────────────►  库存恢复 (StockIncreased)
        │
        ▼
财务: AccountReceivable 红冲

PurchaseReturnShipped ────────────────►  库存扣减 (StockDeducted)

PurchaseReturnCompleted ──────────────►  财务: AccountPayable 红冲
```

---

## 5. 里程碑与交付物

| 里程碑 | 预计完成 | 主要交付物 | 验收标准 |
|--------|----------|------------|----------|
| **M0** | Week 2 | 项目基础设施 | 前后端脚手架可运行，CI/CD 配置完成 |
| **M1** | Week 4 | 商品+伙伴模块 | 商品 CRUD、客户/供应商/仓库管理可用 |
| **M2** | Week 6 | 库存模块 | 库存查询、锁定、调整、盘点功能可用 |
| **M3** | Week 9 | 交易模块 | 销售/采购订单全流程、退货流程可用 |
| **M4** | Week 11 | 财务模块 | 应收应付、收付款、核销、日常收支可用 |
| **M5** | Week 12 | 报表模块 | 销售报表、库存周转、损益表可用 |
| **M6** | Week 14 | 多租户+权限 | 租户隔离、用户角色权限控制可用 |
| **M7** | Week 16 | 外部集成 | 支付网关、电商同步(可选)可用 |
| **M8** | Week 18 | 系统上线 | UAT 通过，性能达标，安全无漏洞 |

---

## 6. 联调验证方案

### 6.1 联调流程

```
开发完成 → 自测通过 → Mock 联调 → 真实联调 → 冒烟测试 → 验收
```

### 6.2 各模块联调方案

#### 6.2.1 商品模块联调 (P1-联调-001)

**参与角色:** BE-1, FE-2, QA-1

**前置条件:**
- 后端: P1-BE-005 Product API 完成
- 前端: P1-FE-002 商品表单完成
- 测试: P1-QA-002 API 集成测试通过

**联调步骤:**

| 步骤 | 操作 | 验证点 | 负责人 |
|------|------|--------|--------|
| 1 | 前端调用商品列表 API | 数据正确展示，分页正常 | FE-2 |
| 2 | 前端调用商品分类 API | 树形结构正确渲染 | FE-2 |
| 3 | 新增商品 | 表单校验、API 调用、列表刷新 | FE-2, BE-1 |
| 4 | 编辑商品 | 数据回显、更新成功 | FE-2, BE-1 |
| 5 | 商品上下架 | 状态切换、列表过滤 | FE-2, BE-1 |
| 6 | 异常场景 | 重复条码、必填校验 | QA-1 |

**联调环境:** 开发环境 (dev)

**产出物:**
- [ ] 联调问题清单
- [ ] 接口文档更新
- [ ] 前后端协议确认

---

#### 6.2.2 库存模块联调 (P2-联调-001)

**参与角色:** BE-2, FE-3, QA-1

**前置条件:**
- 后端: P2-BE-009 Inventory API 完成
- 前端: P2-FE-003 库存调整页面完成
- 测试: P2-QA-003 并发测试通过

**联调步骤:**

| 步骤 | 操作 | 验证点 | 负责人 |
|------|------|--------|--------|
| 1 | 库存列表查询 | 仓库+商品维度正确 | FE-3 |
| 2 | 库存明细查看 | 批次、流水记录正确 | FE-3 |
| 3 | 手动入库 | 数量增加、成本重算 | BE-2, FE-3 |
| 4 | 库存调整 | 调整记录、数量变化 | BE-2, FE-3 |
| 5 | 并发锁定测试 | 乐观锁冲突处理 | QA-1 |
| 6 | 库存预警触发 | 低于阈值时通知 | QA-1 |

**联调环境:** 开发环境 (dev)

---

#### 6.2.3 销售订单联调 (P3-联调-001)

**参与角色:** BE-3, FE-4, QA-1

**前置条件:**
- 后端: P3-BE-007 SalesOrder API 完成
- 前端: P3-FE-004 发货操作完成
- 测试: P3-QA-004 订单-库存联动测试通过

**联调步骤:**

| 步骤 | 操作 | 验证点 | 负责人 |
|------|------|--------|--------|
| 1 | 创建销售订单 | 选择客户、商品、单位、价格 | FE-4 |
| 2 | 确认订单 | 状态变更为 CONFIRMED | BE-3, FE-4 |
| 3 | 库存锁定验证 | 可用库存减少，锁定增加 | BE-2, QA-1 |
| 4 | 发货操作 | 状态变更为 SHIPPED，库存扣减 | BE-3, FE-4 |
| 5 | 应收账款生成验证 | 财务模块自动生成应收 | BE-4, QA-1 |
| 6 | 取消订单 | 状态变更，库存释放 | BE-3, FE-4 |
| 7 | 库存不足场景 | 正确提示，阻止确认 | QA-1 |

**联调环境:** 测试环境 (test)

---

#### 6.2.4 财务核销联调 (P4-联调-001)

**参与角色:** BE-4, FE-5, QA-1

**前置条件:**
- 后端: P4-BE-010 Finance API 完成
- 前端: P4-FE-006 付款核销页面完成
- 测试: P4-QA-003 交易-财务联动测试通过

**联调步骤:**

| 步骤 | 操作 | 验证点 | 负责人 |
|------|------|--------|--------|
| 1 | 应收账款列表 | 按客户、状态筛选正确 | FE-5 |
| 2 | 创建收款单 | 选择客户、金额、支付方式 | FE-5 |
| 3 | 自动核销 | FIFO 策略正确分配 | BE-4, QA-1 |
| 4 | 手动核销 | 指定应收单核销 | FE-5 |
| 5 | 部分核销 | 应收余额正确更新 | BE-4, QA-1 |
| 6 | 余额支付 | 客户余额扣减正确 | BE-4, BE-1 |
| 7 | 超额支付 | 转为预收/余额 | QA-1 |

**联调环境:** 测试环境 (test)

---

#### 6.2.5 多租户联调 (P6-联调-001)

**参与角色:** BE-5, FE-1, QA-3

**联调步骤:**

| 步骤 | 操作 | 验证点 | 负责人 |
|------|------|--------|--------|
| 1 | 租户 A 登录 | Token 包含 tenant_id | BE-5, FE-1 |
| 2 | 租户 A 创建商品 | 数据写入带 tenant_id | BE-5 |
| 3 | 租户 B 登录 | 切换 Token | FE-1 |
| 4 | 租户 B 查询商品 | 看不到租户 A 数据 | QA-3 |
| 5 | SQL 注入测试 | 无法跨租户查询 | QA-3 |
| 6 | 租户停用测试 | 无法登录，数据保留 | QA-3 |

---

## 7. 测试策略

### 7.1 测试金字塔

```
                    ┌──────────────┐
                    │   E2E 测试    │ ← 关键用户流程 (10%)
                    │   (Playwright)│
                    ├──────────────┤
                    │  集成测试     │ ← API 级别 (20%)
                    │  (HTTP 测试)  │
                    ├──────────────┤
                    │              │
                    │  单元测试     │ ← 领域逻辑 (70%)
                    │  (聚合/策略)  │
                    │              │
                    └──────────────┘
```

### 7.2 测试覆盖率要求

| 模块 | 单元测试 | 集成测试 | E2E 测试 |
|------|----------|----------|----------|
| 领域层 (聚合/值对象) | ≥ 90% | - | - |
| 应用层 (Application Service) | ≥ 80% | ≥ 80% | - |
| 接口层 (API) | - | ≥ 90% | - |
| 关键业务流程 | - | - | 100% 覆盖 |

### 7.3 单元测试重点

| 测试对象 | 测试重点 |
|----------|----------|
| Money 值对象 | 精度、币种校验、加减乘除、分配 |
| InventoryItem | 锁定/扣减逻辑、不变量校验 |
| SalesOrder 状态机 | 状态流转、前置条件校验 |
| 成本计算策略 | 移动加权/FIFO 算法正确性 |
| 核销策略 | FIFO 分配逻辑 |

### 7.4 集成测试重点

| 测试场景 | 验证点 |
|----------|--------|
| 商品 CRUD API | 请求/响应格式、状态码、错误码 |
| 订单确认 → 库存锁定 | 事件发布、事件处理、数据一致性 |
| 发货 → 应收生成 | 跨上下文事件流 |
| 收款 → 核销 | 多聚合事务一致性 |

### 7.5 E2E 测试重点

详见 [8. 冒烟测试用例](#8-冒烟测试用例)

---

## 8. 冒烟测试用例

### 8.1 核心业务流程冒烟测试

#### SMOKE-001: 完整销售流程

**优先级:** P0 (必须通过)

**前置条件:**
- 已有商品 A (库存 100)
- 已有客户 X

**测试步骤:**

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 登录系统 | 成功进入首页 |
| 2 | 进入销售开单页面 | 页面正常加载 |
| 3 | 选择客户 X | 客户信息显示正确 |
| 4 | 添加商品 A，数量 10 | 自动计算金额 |
| 5 | 保存订单 | 订单状态为 DRAFT |
| 6 | 确认订单 | 状态变为 CONFIRMED |
| 7 | 查看库存 | 可用 90，锁定 10 |
| 8 | 执行发货 | 状态变为 SHIPPED |
| 9 | 查看库存 | 可用 90，锁定 0 |
| 10 | 查看应收账款 | 新增一条客户 X 应收 |
| 11 | 创建收款单 | 选择现金收款 |
| 12 | 核销应收 | 应收状态变为 PAID |

**验收标准:** 全部步骤通过

---

#### SMOKE-002: 完整采购流程

**优先级:** P0

**前置条件:**
- 已有商品 B (库存 0)
- 已有供应商 Y

**测试步骤:**

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 创建采购订单 | 选择供应商 Y，商品 B，数量 50 |
| 2 | 确认采购订单 | 状态变为 CONFIRMED |
| 3 | 执行收货 (数量 30) | 状态变为 PARTIAL_RECEIVED |
| 4 | 查看库存 | 商品 B 可用 30 |
| 5 | 查看应付账款 | 新增一条供应商 Y 应付 |
| 6 | 继续收货 (数量 20) | 状态变为 COMPLETED |
| 7 | 查看库存 | 商品 B 可用 50 |
| 8 | 创建付款单 | 支付应付 |
| 9 | 核销应付 | 应付状态变为 PAID |

---

#### SMOKE-003: 销售退货流程

**优先级:** P1

**前置条件:**
- 已完成 SMOKE-001 (有已发货订单)

**测试步骤:**

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 基于原订单创建退货单 | 选择退货商品和数量 |
| 2 | 提交审批 | 状态变为 PENDING_APPROVAL |
| 3 | 审批通过 | 状态变为 APPROVED |
| 4 | 确认收货 | 状态变为 RECEIVING |
| 5 | 完成退货 | 状态变为 COMPLETED |
| 6 | 查看库存 | 可用库存增加 |
| 7 | 查看应收 | 红冲或调整 |

---

#### SMOKE-004: 库存盘点流程

**优先级:** P1

**前置条件:**
- 商品 C 系统库存 100，实际库存 95

**测试步骤:**

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 创建盘点单 | 选择仓库和商品 |
| 2 | 录入实际数量 95 | 差异 -5 显示 |
| 3 | 提交盘点 | 状态变为待审核 |
| 4 | 审核通过 | 库存调整执行 |
| 5 | 查看库存 | 可用数量变为 95 |
| 6 | 查看库存流水 | 有调整记录 |

---

#### SMOKE-005: 多租户隔离

**优先级:** P0

**前置条件:**
- 租户 A 有商品 "商品-A"
- 租户 B 无此商品

**测试步骤:**

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 租户 A 登录 | 成功 |
| 2 | 查询商品列表 | 看到 "商品-A" |
| 3 | 退出登录 | 成功 |
| 4 | 租户 B 登录 | 成功 |
| 5 | 查询商品列表 | 看不到 "商品-A" |
| 6 | 尝试直接访问租户 A 数据 | 返回 403 或空 |

---

#### SMOKE-006: 权限控制

**优先级:** P0

**前置条件:**
- 用户 "销售员" 只有销售模块权限
- 用户 "财务" 有财务模块权限

**测试步骤:**

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | "销售员" 登录 | 成功 |
| 2 | 访问销售订单页面 | 正常显示 |
| 3 | 访问财务应收页面 | 无权限提示 |
| 4 | API 直接访问财务接口 | 返回 403 |
| 5 | "财务" 登录 | 成功 |
| 6 | 访问财务应收页面 | 正常显示 |
| 7 | 访问销售订单页面 | 根据配置决定 |

---

### 8.2 冒烟测试执行计划

| 用例 | 执行时机 | 执行人 | 自动化 |
|------|----------|--------|--------|
| SMOKE-001 | 每日构建后 | QA-2 | 是 (Playwright) |
| SMOKE-002 | 每日构建后 | QA-2 | 是 |
| SMOKE-003 | Phase 3 完成后 | QA-2 | 是 |
| SMOKE-004 | Phase 2 完成后 | QA-2 | 是 |
| SMOKE-005 | Phase 6 完成后 | QA-3 | 是 |
| SMOKE-006 | Phase 6 完成后 | QA-3 | 是 |

---

## 9. 风险管理

### 9.1 技术风险

| 风险 | 概率 | 影响 | 缓解措施 | 负责人 |
|------|------|------|----------|--------|
| 库存并发超卖 | 中 | 高 | 乐观锁 + 分布式锁 | BE-2 |
| 事件丢失导致不一致 | 中 | 高 | Outbox Pattern + 重试 | BE-2 |
| 财务计算精度问题 | 低 | 高 | Decimal 类型 + 单元测试 | BE-4 |
| 多租户数据泄露 | 低 | 极高 | 中间件强制过滤 + 安全测试 | BE-5, QA-3 |
| 外部支付回调失败 | 中 | 中 | 异步重试 + 人工核对 | BE-5 |

### 9.2 进度风险

| 风险 | 概率 | 影响 | 缓解措施 | 负责人 |
|------|------|------|----------|--------|
| 需求变更频繁 | 中 | 中 | 迭代开发 + 范围控制 | PD-1 |
| 关键人员请假 | 中 | 中 | 交叉培训 + 文档完善 | 项目经理 |
| 技术选型返工 | 低 | 高 | 早期 POC 验证 | BE-1 |
| 联调问题阻塞 | 高 | 中 | Mock 服务 + 并行开发 | 全体 |

---

## 10. 进度跟踪

### 10.1 状态说明

- ⬜ 未开始
- 🔵 进行中
- ✅ 已完成
- ⏸️ 暂停
- ❌ 阻塞

### 10.2 Phase 0 进度

| 任务ID | 任务名称 | 负责人 | 状态 | 开始日期 | 完成日期 | 备注 |
|--------|----------|--------|------|----------|----------|------|
| P0-BE-001 | 项目脚手架搭建 | BE-1 | ⬜ | - | - | |
| P0-BE-002 | 数据库连接配置 | BE-1 | ⬜ | - | - | |
| P0-BE-003 | 日志框架配置 | BE-1 | ⬜ | - | - | |
| P0-BE-004 | 数据库迁移工具 | BE-1 | ⬜ | - | - | |
| P0-BE-005 | 通用值对象实现 | BE-2 | ⬜ | - | - | |
| P0-BE-006 | 领域事件基础设施 | BE-2 | ⬜ | - | - | |
| P0-BE-007 | 策略注册中心 | BE-2 | ⬜ | - | - | |
| P0-BE-008 | HTTP 框架配置 | BE-1 | ⬜ | - | - | |
| P0-BE-009 | API 响应格式统一 | BE-1 | ⬜ | - | - | |
| P0-BE-010 | 单元测试框架 | QA-1 | ⬜ | - | - | |
| P0-FE-001 | 前端脚手架搭建 | FE-1 | ⬜ | - | - | |
| P0-FE-002 | UI 组件库集成 | FE-1 | ⬜ | - | - | |
| P0-FE-003 | 路由配置 | FE-1 | ⬜ | - | - | |
| P0-FE-004 | 状态管理配置 | FE-1 | ⬜ | - | - | |
| P0-FE-005 | HTTP 客户端封装 | FE-1 | ⬜ | - | - | |
| P0-FE-006 | 布局组件 | FE-1 | ⬜ | - | - | |
| P0-FE-007 | 通用表单组件 | FE-2 | ⬜ | - | - | |
| P0-FE-008 | 通用表格组件 | FE-2 | ⬜ | - | - | |
| P0-FE-009 | 前端测试框架 | QA-2 | ⬜ | - | - | |
| P0-PD-001 | 商品模块原型 | PD-1 | ⬜ | - | - | |
| P0-PD-002 | 伙伴模块原型 | PD-1 | ⬜ | - | - | |
| P0-PD-003 | 库存模块原型 | PD-1 | ⬜ | - | - | |
| P0-PD-004 | 交易模块原型 | PD-2 | ⬜ | - | - | |
| P0-PD-005 | 财务模块原型 | PD-2 | ⬜ | - | - | |

### 10.3 周报模板

```markdown
## 周报 - Week XX (YYYY-MM-DD ~ YYYY-MM-DD)

### 本周完成
- [ ] 任务ID - 任务名称

### 本周进行中
- [ ] 任务ID - 任务名称 (进度 XX%)

### 下周计划
- [ ] 任务ID - 任务名称

### 风险与问题
- 问题描述及影响
- 需要的支持

### 里程碑进度
- M0: XX% 完成
```

---

## 附录

### A. 技术栈选型 (已确定)

| 层级 | 技术选型 | 版本要求 |
|------|----------|----------|
| 后端语言 | **Go** | 1.21+ |
| 后端框架 | **Gin** | v1.9+ |
| ORM | **GORM** | v1.25+ |
| 数据库 | **PostgreSQL** | 15+ |
| 缓存 | **Redis** | 7+ |
| 消息队列 | **Redis Stream** | - |
| 前端框架 | **React + TypeScript** | React 18+, TS 5+ |
| UI 组件库 | **Semi Design** | @douyinfe/semi-ui |
| 状态管理 | **Zustand** | 4+ |
| 路由 | **React Router** | v6 |
| HTTP 客户端 | **Axios** | 1.6+ |
| 表单 | **React Hook Form** | 7+ |
| 构建工具 | **Vite** | 5+ |
| 测试 | **Vitest + Playwright** | - |

详细开发规范请参考: `CLAUDE.md`

### B. 目录结构建议

```
erp/
├── backend/
│   ├── cmd/                    # 入口
│   ├── internal/
│   │   ├── domain/             # 领域层
│   │   │   ├── catalog/        # 商品上下文
│   │   │   ├── partner/        # 伙伴上下文
│   │   │   ├── inventory/      # 库存上下文
│   │   │   ├── trade/          # 交易上下文
│   │   │   ├── finance/        # 财务上下文
│   │   │   └── shared/         # 共享内核
│   │   ├── application/        # 应用层
│   │   ├── infrastructure/     # 基础设施层
│   │   └── interfaces/         # 接口层
│   ├── migrations/             # 数据库迁移
│   └── tests/                  # 测试
├── frontend/
│   ├── src/
│   │   ├── components/         # 通用组件
│   │   ├── pages/              # 页面
│   │   ├── services/           # API 服务
│   │   ├── stores/             # 状态管理
│   │   └── utils/              # 工具函数
│   └── tests/                  # 测试
├── docs/                       # 文档
└── docker/                     # Docker 配置
```

### C. API 版本管理

- 所有 API 使用 `/api/v1/` 前缀
- 破坏性变更时升级版本号
- 旧版本维护至少 6 个月

### D. 变更记录

| 日期 | 版本 | 变更内容 | 修改人 |
|------|------|----------|--------|
| 2026-01-23 | v1.0 | 初始版本 | PM |

---

**文档维护:** 本文档由项目经理维护，每周更新进度跟踪部分。重大变更需通知全体开发人员。
